<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pi-uLCD: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="highlight.min.css">
<script type="module" src="highlight.min.js"></script>
<link rel="stylesheet" href="darcula.css">
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Pi-uLCD
   </div>
   <div id="projectbrief">Native uLCD Library for the Raspberry Pi</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Pi-uLCD Documentation</div></div>
</div><!--header-->
<div class="contents">
<h1>Pi uLCD</h1>
<p>
Pi uLCD is a project for porting over the <a target="_blank" href="https://os.mbed.com/users/4180_1/notebook/ulcd-144-g2-128-by-128-color-lcd/">Mbed uLCD library made by Jim Hamblen</a> over to the Raspberry Pi ecosystem. 
4D Systems' uLCD is a cheap and small LCD screen with many programmable features with extensive support. 4DGL did design this uLCD for the RPi, but they did not provide as programmer-friendly an API to work with. Much of the work is tied down to their GUI tools. The mBed library is a great alternative, however not the target platform, as it is tied to an underpowered system. 
The Raspberry Pi was an excellent candidate as a replacement but it had no uLCD support. Our solution was keeping the same, easy-to-use interface of the Mbed library with native support for Raspberry Pi, allowing access to a more powerful system while maintaining all the same functions and even adding a few extra ones such as loading media through Java's JNI.
</p>

<h1>Hardware of Pi uLCD</h1>
<h3>List of components:</h3>
<ul>
<li>Raspberry Pi Model B </li>
<li>4D Systems uLCD</li>
<li>SD card (for loading media)</li>
</ul>

<center>
  <img src="rpi.png">
  <img src="4dgl-ulcd.png">
</center>

<p>
Pins 14 and 15 are the only transmitter/receiver pins available on the Pi, and these were connected to the respective TX and RX pins of the uLCD. Pins 4 and 6 were used to power the uLCD while pin 11 provided its reset signal.
</p>

<center>
  <img src="rpi-headers.png">
  <img src="rpi-headers-labelled.png">
</center>


<h1>Software of Pi uLCD</h1>
<h3>List of components:</h3>
<ul>
<li>PIGPIO library</li>
<li>Java's JNI (Java Native Interface)</li>
<li>Cmake (linking and compiling)</li>
</ul>

<h3>uLCD Library Functions</h3>
The entire Mbed uLCD was implemented natively for the Pi: general, graphics, media, text, and screen data commands. 

<pre><code>
// General Commands *******************************************************************************
 
    void cls();
    void reset();
    void baudrate(int speed);
    void background_color(int color);
    void textbackground_color(int color);
    void display_control(char mode);
    void display_power(char mode);
    void set_volume(char value);
 
// Graphics Commands *******************************************************************************

    void circle(int x , int y , int radius, int color);
    void filled_circle(int x , int y , int radius, int color);
    void triangle(int, int, int, int, int, int, int);
    void line(int, int, int, int, int);
    void rectangle(int, int, int, int, int);
    void filled_rectangle(int, int, int, int, int);
    void pixel(int, int, int);
    int  read_pixel(int, int);
    void pen_size(char);
    void BLIT(int x, int y, int w, int h, int *colors);
 
// Text Commands
    void set_font(char);
    void set_font_size(char width, char height);  
    void text_mode(char);
    void text_bold(char);
    void text_italic(char);
    void text_inverse(char);
    void text_underline(char);
    void text_width(char);
    void text_height(char);
    void text_char(char, char, char, int);
    void text_string(char *, char, char, char, int);
    void locate(char, char);
    void color(int);
    void putc(char);
    void puts(char *);
 
//Media Commands
    int media_init();
    void set_byte_address(int, int);
    void set_sector_address(int, int);
    char read_byte();
    int  read_word();
    void write_byte(int);
    void write_word(int);
    void flush_media();
    void display_image(int, int);
    void display_video(int, int);
    void display_frame(int, int, int);
 
// Screen Data
    int type;
    int revision;
    int firmware;
    int reserved1;
    int reserved2;
 
// Text data
    char current_col;
    char current_row;
    int  current_color;
    char current_font;
    char current_orientation;
    char max_col;
    char max_row;
    int current_w, current_h;
    int current_fx, current_fy;
    int current_wf, current_hf;
  </code></pre>

We also implemented key objects required in the uLCD class like Serial and DigitalOut objects to have control of the uLCD as close as possible to how it is in Mbed.

<pre><code>
	const int DEFAULT_SERIAL_BAUD_RATE = 9600;
    	class Serial {
        public:
        Serial(const char* location, int baudrate = DEFAULT_SERIAL_BAUD_RATE);
        ~Serial();
        int baud(int baudrate);
        char getc();
        int putc(const unsigned char c);
        bool readable();

        private:
        const char* location;
        int baudrate;
        int _ser;
    	};


	class DigitalOut {
        public:
        DigitalOut(int pinname);
        DigitalOut(int pinname, int value);
        int read();
        void write(int value);
        int is_connected();

        DigitalOut& operator= (int value);
        DigitalOut& operator= (DigitalOut &rhs);
        operator int();

        private:
        int pinname;
    	};
</code></pre>

However, there are some key differences. You must first call <span><code>gpioInitialise()</code></span> and <span><code>gpioTerminate()</code></span> need to be called due to how the PIGPIO library works, which hurts the abstraction of the interface. Similarly, PIGPIO does not support high baud rates. Lastly, when initialising the uLCD class you do not provide a pin as a parameter but the Serial address of the device.


<h1>Additional Features</h1>
<center>
  <img src="pi-ulcd-additional-features.png">
</center>
Some extra functionalities we added in our project is linking the Pi uLCD library into a shared library. By doing so, we can interface into Java's simpler media control through JNI and load media like videos or images (or even a list of image files) onto the SD card in the required RAW format for the uLCD. This is particularly useful since this format isn't explained anywhere and therefore no traditional APIs exist (although there is a tool called graphics composer developed by 4DGL that can write to SD cards, but that is a GUI tool, and does not have any known API). The Java interface also creates a header file with a definition for each image and its corresponding sector address in the SD Card, that can be used with API calls like <span><code>display_image()</code></span>.

<h1>Future Ideas</h1>
<center>
  <img src="pi-ulcd-future-ideas.png">
</center>
The uLCD works perfectly on the Raspberry Pi, but we would like to implement more powerful and higher level features that would let us take advantage of the uLCD to its maximum. One of them is to use JNI and integrate it with JavaFX so one can use WebViewer (render HTML and CSS files), design GUI elements while in a more UI/UX design-friendly environment. Another similar idea is to create a Python extension, so the simplicty of the Python syntax and speed of C++ can be combined into one. One could load media and program the uLCD all in the same language.
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>

<script type="module">
  import hljs from './highlight.min.js';
  document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((el) => {
    hljs.highlightElement(el,  {language: 'cpp'});
  });
  document.querySelectorAll('span code').forEach((el) => {
    hljs.highlightElement(el,  {language: 'cpp'});
    el.style.display = "inline";
  });
  });
</script>
</body>
</html>
